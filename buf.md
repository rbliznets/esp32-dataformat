# Команды для работы с буфером в памяти по 2-му каналу
В корне json должен быть только один элемент __"buf"__. Корень json может содержать другие элементы. 
Одновременно передаётся только одна команда, следующая только после получения ответа.
При возникновении ошибки при обработке команды выдаётся следующий ответ:
```
{
    "buf":
    {
        "error":"описание ошибки"
    }
}
```
### 1.Создать буфер.
```
{
    "buf":
    {
        "create":1024,  // размер буфера в байтах
        "part":200      // максимальный размер пакета в байтах (необязательное)
    }
}
```
Ответ
```
{
    "buf":
    {
        {"ok":"Buf was created 1024(200)"}
    }
}
```
В случае успеха, можно передавать пакеты устройству по 2-му каналу.
### 2.Создать буфер из файла.
```
{
    "buf":
    {
        "rd":"udp.json",    //имя файла
        "part":200      // максимальный размер пакета в байтах (необязательное)
    }
}
```
Ответ
```
{
    "buf":
    {
        "fr":"udp.json",    //имя файла
        "ok":"buffer was loaded from udp.json",
        "size":170,   // размер файла в байтах
        "part":200    // максимальный размер пакета в байтах
    }
}
```
В случае успеха, устройство начинает передавать пакеты по 2-му каналу.
### 3.Проверить заполненность буфера.
```
{
    "buf":
    {
        "check":null
    }
}
```
Ответ
```
{
    "buf":
    {
        "empty":[0]  // список номеров пакетов, которые нужно передать устройству
    }
}
```
### 4.Записать буфер в файл.
```
{
    "buf":
    {
        "wr":"t.dat", // имя файла
        "free":null // освободить буфер после записи 
    }
}
```
Ответ
```
{
    "buf":
    {
        "ok":"file t.dat was saved"
    }
}
```
### 5.Записать буфер как обновление прошивки.
```
{
    "buf":
    {
        "ota":null, 
        "free":null // освободить буфер после записи 
    }
}
```
Ответ
```
{
    "buf":
    {
        "ok":"firmware was saved"
    }
}
```
### 6. Очистить буфер.
```
{
    "buf":
    {
        "free":null
    }
}
```
Ответ
```
{
    "buf":
    {
        "ok":"buffer was deleted"
    }
}
```
## Формат данных 2-го канала.
Первые два байта - номер пакета, затем данные (максимальный размер пакета если не последний пакет).