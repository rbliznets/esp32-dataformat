/*!
	\file
	\brief Класс для работы с NVS.
	\authors Близнец Р.А. (r.bliznets@gmail.com)
	\version 1.1.0.0
	\date 02.05.2024
*/

#pragma once

#include "sdkconfig.h"

#include <nlohmann/json.hpp>
using json = nlohmann::json;

/// Статический класс для работы с Non-Volatile Storage (NVS) памятью.
/*!
  Предоставляет статические методы для инициализации, работы с переменными
  и выполнения служебных операций с NVS памятью ESP32.
  Поддерживает работу с различными типами данных: целые числа, числа с плавающей точкой, строки.
*/
class CNvsSystem
{
public:
	/// Инициализация NVS памяти.
	/*!
	  Выполняет инициализацию основного раздела NVS и дополнительного раздела "nvs2".
	  При необходимости автоматически выполняет очистку памяти если обнаружены ошибки.
	  \return true если инициализация успешна, false в случае ошибки.
	*/
	static bool init();
	
	/// Деинициализация NVS памяти.
	/*!
	  Освобождает ресурсы NVS памяти и закрывает файловую систему.
	  Вызывается перед завершением работы с NVS.
	*/
	static void free();

	/// Обработка JSON-команд работы с NVS.
	/*!
	  Обрабатывает команды работы с NVS памятью из JSON объекта.
	  Поддерживаемые команды:
	  - "clear": очистка всей NVS памяти
	  - "reset": перезагрузка устройства
	  - Работа с переменными различных типов (u8, i8, i16, i32, u32, float, double)
	  
	  \param[in] cmd JSON-объект с командами работы с NVS (ключ "nvs" в корне).
	  \param[out] answer JSON-объект с результатами выполнения команд.
	*/
	static void command(json& cmd, json& answer);
};