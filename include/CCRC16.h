/*!
	\file
	\brief Алгоритм CRC-16.
	\authors Близнец Р.А. (r.bliznets@gmail.com)
	\version 1.0.0.0
	\date 10.03.2017
*/

#pragma once

#include <stdint.h>

/// Класс CRC16
/*!
 Вычисление и проверка CRC-16 через статические методы.
 Используется полином X^16 + X^15 + X^2 + 1 (0x8005) в отраженном виде.
 */
class CCRC16
{
protected:
	static const uint16_t CRCTable[256]; ///< Предвычисленная таблица значений CRC-16 для ускорения вычислений

public:
	/// Проверить CRC-16 данных.
	/*!
	  Проверяет целостность данных путем вычисления CRC-16 и сравнения с ожидаемым результатом.
	  Используется полином X^16 + X^15 + X^2 + 1 (0x8005) в отраженном виде.
	  Начальное значение CRC: 0xFFFF.
	  
	  \param[in] data Указатель на массив данных для проверки CRC.
	  \param[in] size Размер данных в байтах.
	  \return true если CRC вычислено правильно и данные целостны, false если данные повреждены.
	*/
	static bool Check(uint8_t *data, uint16_t size);
	
	/// Вычислить CRC-16 для данных.
	/*!
	  Вычисляет контрольную сумму CRC-16 для массива данных.
	  Используется полином X^16 + X^15 + X^2 + 1 (0x8005) в отраженном виде.
	  Начальное значение CRC: 0xFFFF.
	  
	  \param[in] data Указатель на массив данных для вычисления CRC.
	  \param[in] size Размер данных в байтах.
	  \param[out] crc Указатель на переменную, куда будет записан результат вычисления CRC-16.
	*/
	static void Create(uint8_t *data, uint16_t size, uint16_t *crc);

	/// Получить начальное значение CRC-16.
	/*!
	  Возвращает начальное значение для инициализации вычисления CRC-16.
	  \return Начальное значение CRC-16 (0xFFFF).
	*/
	inline static uint16_t Init() { return 0xffff; };
	
	/// Добавить данные к существующему CRC-16.
	/*!
	  Позволяет инкрементально вычислять CRC-16 для потоковых данных или больших объемов.
	  Продолжает вычисление CRC-16 с текущего значения.
	  
	  \param[in] data Указатель на массив дополнительных данных.
	  \param[in] size Размер дополнительных данных в байтах.
	  \param[in,out] crc Указатель на переменную с текущим значением CRC-16, которое будет обновлено.
	*/
	static void Add(uint8_t *data, uint16_t size, uint16_t *crc);
};